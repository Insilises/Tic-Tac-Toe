<!-- 
Alexis Brunner
Cosc 4345, Section 01
10/11/24
Creates an interactive Tic Tac Toe game to be played in-person
by two players. Entirely drawn with points.
-->

<html>
    <style type = "text/css">
        canvas {
            background: red;
        }
    </style>

    <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec4 vPos;
    void main() {
        gl_Position = vPos;
        gl_PointSize = 1.0;
    }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;
    uniform vec4 u_color;
    void main() {
        gl_FragColor = u_color;
    }
</script>

    <script type = "text/javascript" src = "initShaders.js"></script>
    <script type = "text/javascript" src = "webgl-utils.js"></script>
    <script type = "text/javascript" src = "gameBoard.js"></script>
    <script type = "text/javascript" src = "XPiece.js"></script>

    <script type = "text/javascript">
        var canvas;
        var gl;
        window.onload = init;

        function init() {
            canvas = document.getElementById("gl-canvas");
            gl = WebGLUtils.setupWebGL(canvas);
            if (!gl) {
                alert("WebGL isn't available");
            }

            gl.viewport(0, 0, canvas.width, canvas.height);
            gl.clearColor(0.0, 0.0, 0.0, 1.0); //TODO: Fill with another color
            gl.clear(gl.COLOR_BUFFER_BIT);

            var program = initShaders(gl, "vertex-shader", "fragment-shader");
            gl.useProgram(program);

            var vPos = gl.getAttribLocation(program, "vPos");
            var colorUniformLocation = gl.getUniformLocation(program, "u_color");

            var buffer = gl.createBuffer();

            var gameBoardVertices = returnGameBoardVertices(-800, -500, 800, 500);
            for (i=0; i < gameBoardVertices.length; i++)
                gameBoardVertices[i] = gameBoardVertices[i]/1000.0;

            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(gameBoardVertices), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(vPos);
            gl.vertexAttribPointer(vPos, 2, gl.FLOAT, false, 0, 0);

            //Actual drawing
            gl.uniform4f(colorUniformLocation, 1.0, 1.0, 1.0, 1.0);
            gl.drawArrays(gl.POINTS, 0, gameBoardVertices.length/2);

            //TODO: Remove later; this is just to test before trying inputs
            //Drawing a line for the X Piece
            var lineVertices = returnXPieceVertices(-800, 167, -267, 500); //Drawing in top left square?

            for (i=0; i < lineVertices.length; i++) {
                lineVertices[i] = lineVertices[i]/1000.0;
            }

            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(lineVertices), gl.STATIC_DRAW);
            gl.uniform4f(colorUniformLocation, 0.0, 1.0, 1.0, 1.0);
            gl.drawArrays(gl.POINTS, 0, lineVertices.length/2);

            console.log(lineVertices);
        }




    </script>
    
    <body>
        <canvas id = "gl-canvas" width = "1000" height = "1000">
            Oops... Your browser doesn't support html5's canvas elements.
        </canvas>
    </body>
</html>